<html>
<head>
<title>Vertex Database Reference</title>
<style>
td { font-size: .9em; font-family: sans; }
h1 { font-size: 1.2em; font-weight: bold; font-family: sans; line-height: 2em; }
h2 { font-size: 1em; font-weight: bold; font-family: sans; line-height: 1.4em; }
h3 { font-size: .7em; font-weight: normal; font-family: serif; }
hr { height: 1px;  background: black; border: 0; margin: 0em 0em 0em 0em; }
.api1 { font-size: 1em; font-weight: bold; font-family: sans; line-height: 1.4em; }
.api2 { font-size: 1em; font-weight: bold; font-family: sans; line-height: 1.4em; color: #666666;}
th { text-align: left; font-size: 1em; font-weight: normal; font-family: sans; line-height: 1.4em; color: #666666;}
pre { text-align: left; font-size: .9em; font-weight: normal; font-family: courier; color: #666666;}

</style>
</head>
<body>

<center>
<br><br>
<table border=0 style="width:40em">
<tr><td>

<h3>&copy Steve Dekorte and Rich Collins 2009 <br> 
	Creative Commons Attribution License 3.0
	<!-- License: http://creativecommons.org/licenses/by/3.0/ -->
	</h3>

<hr style="background:#aaa;">
<hr>

<p style="height:1.25em">

<h1>Vertex Database Reference</h1> 
<!--
<h2 style="color: #888;">Steve Dekorte <br> Rich Collins</h2>
<p style="height:2em">
<br>
-->
<br>



<h1>Node Operations</h1>

<!--
<table>
	<tr><th style="width:6em">api</th>
		<th style="width:15em">sample request</th>
		<th style="width:15em">sample response</th></tr>
	<tr><td>mkdir</td><td>/path?action=mkdir</td><td>null</td><tr>
</table>	
-->
			
<p class=api1>mkdir</p>
<ul>
	Creates a node at the specified path. If the path already exists, no operation is performed. Returns null on success.
<pre>
sample request: /path?action=mkdir
sample response: null
</pre>
</ul>
<br>

<p class=api1>rm</p>
<ul>
	Removes a node at the specified path. Returns an error if the path does not exist. Returns null on success.
<pre>
sample request: /path?action=rm
sample response: null
</pre>
</ul>
<br>

<p class=api1>size</p>
<ul>
	Returns the number of slots at the node in the specified path. Returns an error if the path doesn't exist.
<pre>
sample request: /path?action=size
sample response: 423
</pre>
</ul>
<br>

<p class=api1>link</p>
<ul>
	Links a node at a source path to a key on a node at the destination path. Returns an error if the path doesn't exist.
<pre>
sample request: /sourcePath/?action=link&key=k&toPath=destinationPath
sample response: 423
</pre>
</ul>
<br>

<br>

<h1>Value Operations</h1>


<p class=api1>read</p>
<ul>
	Read a value at a given path. Returns the value on success.	
<pre>
sample request: /path?action=read 
sample response: "foo"
</pre>
</ul>
<br>

<p class=api1>write</p> 
<ul>
	Sets or appends a value at a specified path. Returns null on success.
<p class=api2>set</p>
<pre>
sample request: /path?key=k&action=write&mode=set
with post: foo
sample response: null
</pre>

<p class=api2>append</p>
<pre>
sample request: /path?action=write&mode=append
with post: bar
sample response: null
</pre>
</ul>
<br>



<br>
<h1>Select Operations</h1>


<p class=api1>select</p>

<ul>
optional parameters:
<ul>
<pre>
before=key
after=key
count=max
whereKey=k&whereValue=v
</pre>
</ul>


<p class=api2>pairs</p>
<ul>
<pre>
sample request: /path?action=select&op=pairs
sample response: [["a","1"], ["b","2"], ["c","3"]]
</pre>
</ul>

<p class=api2>keys</p>
<ul>
	<pre>
sample request: /path?action=select&op=keys
sample response: ["a", "b", "c"]
</pre>
</ul>

<p class=api2>values</p>
<ul>
<pre>
sample request: /path?action=select&op=values
sample response: ["1", "2", "3"]
</pre>
</ul>

<p class=api2>object</p>
<ul>
<pre>
sample request: /path?action=select&op=object
sample response: {"a":"1"; "b":"2"; "c":"3" } ???
</pre>
</ul>
	
<p class=api2>counts</p>
<ul>
<pre>
sample request: /path?action=select&op=counts
sample response: ???
</pre>
</ul>

</ul>
</ul>

<!--
<p class=api1>permissions</p>
<ul>
<p class=api1>chmod</p>
<p class=api1>chown</p>
<p class=api1>stat</p>
</ul>
-->

<br>
<h1>Queue Operations</h1>


<p class=api1>queuePopTo</p>
<ul>
Returns the key.
<p>
optional parameters: 
<p>
<ul>
<pre>
whereKey=k&whereValue=v 
ttl=numberOfSeconds
</pre>
</ul>

<pre>
sample request: /sourcePath/?action=queuePopTo&toPath=/destinationPath
sample response: akey123
</pre>
</ul>
<br>
	
<p class=api1>queueExpireTo</p>

Returns the number of items expired.
<ul>
<pre>
sample request: /sourcePath/?action=queueExpireTo&toPath=/destinationPath
sample response: 42345
</pre>
</ul>

<br>
<h1>Transactions</h1>

<p class=api1>transaction</p>
<ul>
Allows a set of actions to be done in a single request. Returns null on success.
<pre>
sample request: /frompath/?action=transaction
with post: [list of request urls]
sample response: null
</pre>
</ul>

<!--
<p class=api1>users</p>
<ul>
	<p class=api1>newUser</p>
	sample request: /frompath/?action=newUser<br>
	<p>

	returns new user id and vends cookie for user


<p class=api1>login</p>
sample request: /?action=login&email=e&password=p
<p>
	looks in /users/e path and vends user key cookie if password matches
	

</ul>

<p class=api1>admin</p>
<ul>
<p class=api1>shutdown</p>
sample request: /path?action=shutdown

<p class=api1>backup</p>
sample request: /path?action=backup

<p class=api1>collectGarbage</p>
sample request: /path?action=collectGarbage

<p class=api1>stats</p>
sample request: /path?action=stats
</ul>
-->

<br>
<br>
<br>
<hr style="background:#aaa; width:20em;">
<hr style="background:#888; width:20em;">
<br>

<h2>Notes</h2>

For brevity, the "http://host:port" parts of the request URLs fields are left out and the word "path" is used to mean any forward slash delimited path. 

<h2>Error Handling</h2>

On error, a HTPP response status of 500 is sent with the HTTP content containing the error message. 


<br><br><br>
</td>
</tr>
</table>
</center>
